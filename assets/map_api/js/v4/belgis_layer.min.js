function WMSLayer(d,b,f){var c=0;this.id_str="belgis_wms";this.wmsUrl=b;this.wmsLayersList=f;var a=d;var e=new Array();WMSTile=function(l,g,k,n,j,i,h,p,m){this.id=l;this.isLoading=false;this.Left=k;this.Top=n;this.Url=g;this.placeX=j;this.placeY=i;this.width=h;this.height=p;this.image=m;this.deferred=null;this.draw=function o(q){var r=this;var s=this.image;s.onload=function(){if(r.deferred.state()!="rejected"){r.deferred.resolve()}};s.onerror=function(){this.src=urlMapF+"/images/spacer.gif";r.deferred.reject()};return r.deferred.promise()}};this.setWMSLayerOpacity=function(g){a=g};this.setWMSLayersList=function(g){this.wmsLayersList=g};this.setWMSUrl=function(g){this.wmsUrl=g;if(this.wmsUrl==null||this.wmsUrl==""){this.clearSrc()}};this.clearSrc=function(){e.forEach(function(j,h,g){j.image.src=""})};this.clearLayer=function(){e.length=0};this.clearTile=function(g,h){e[h].deferred.reject()};this.addTile=function(p,k,j,n,i,h,g,o,m){var l=new Image();url=this.wmsUrl+m.nwx+","+m.sey+","+m.sex+","+m.nwy;url=url.replace("{h}",(o)).replace("{w}",g).replace("{ll}",this.wmsLayersList);if(this.wmsUrl!=null&&this.wmsUrl!=""){l.src=url}e[k]=new WMSTile(this.id_str+k,url,j,n,i,h,g,o,l);e[k].deferred=new $.Deferred();e[k].draw(p).done(function(){p.save();p.globalAlpha=a;if(e[k].image.width!=0){p.drawImage(e[k].image,j,n)}p.restore()})};this.replaceTile=function(o,i,h,k,m,l,g,n,j){if(this.wmsUrl==null||this.wmsUrl==""){return}e[i].Left=h;e[i].Top=k;e[i].placeX=m;e[i].placeY=l;url=this.wmsUrl+j.nwx+","+j.sey+","+j.sex+","+j.nwy;url=url.replace("{h}",(n)).replace("{w}",g).replace("{ll}",this.wmsLayersList);if(e[i].image.src!=url&&e[i].deferred.state()=="pending"){e[i].deferred.reject()}if(e[i].image.src==url&&e[i].deferred.state()=="resolved"){}else{e[i].image.src=url;e[i].deferred=new $.Deferred();e[i].draw(o).done(function(){if(e[i].image.width!=0){if(a!=1){o.clearRect(h,k,g,n)}o.save();o.globalAlpha=a;o.drawImage(e[i].image,h,k);o.restore()}})}};this.moveAllTiles=function(g,i,h){if(this.wmsLayersList!=null&&this.wmsLayersList.length>0){e.forEach(function(l,k,j){if(l.deferred.state()=="resolved"){g.save();g.globalAlpha=a;if(l.image.width!=0){g.drawImage(l.image,l.Left+i,l.Top+h)}g.restore()}})}};this.deleteTile=function(g){e[g].image.src="";e.splice[g]};this.getTileDeferred=function(g){return e[g].deferred};this.getTileId=function(g){return e[g].id};this.getTileLeft=function(g){return e[g].Left};this.getTileTop=function(g){return e[g].Top};this.getTilePlaceX=function(g){return e[g].placeX};this.getTilePlaceY=function(g){return e[g].placeY};this.getMinX=function(l,k,g){var j=-1;var h=k;for(var i=1;i<=g;i++){if((e[i].Left+l)<h){h=e[i].Left+l;j=i}}return Array(j,h)};this.getMaxX=function(l,k,g){var j=-1;var i=k;for(var h=1;h<=g;h++){if((e[h].Left+l)>i){i=e[h].Left+l;j=h}}return Array(j,i)};this.getMinY=function(n,m,k,g){var l=-1;var i=m;for(var j=0;j<k;j++){var h=j*g+1;if((e[h].Top+n)<i){i=e[h].Top+n;l=h}}return Array(l,i)};this.getMaxY=function(n,m,k,g){var l=-1;var j=m;for(var i=0;i<k;i++){var h=i*g+1;if((e[h].Top+n)>j){j=e[h].Top+n;l=h}}return Array(l,j)}};