(function() {
    var oneFile = (typeof BelgisMapApi == "object");
    window.BelgisMapApi = {
        
        /**
         * Relative path of this script.
         */
        thisScript: "belgis_map_api.min.js",

        /**
         * Return path to this script.
         */
		getLocation: function ()
		{
				var location = "";            
				var match_str = new RegExp("(^|(.*?\\/))(" + BelgisMapApi.thisScript + ")(\\?|$)");
			 
				var scripts = document.getElementsByTagName('script');
				for (var i=0, len=scripts.length; i<len; i++)
				{
					var src = scripts[i].getAttribute('src');
					if (src)
					{
						var match = src.match(match_str);
						if(match)
						{
							location = match[1];
							break;
						}
					}
				}
				return location;
		  }
	};

    if(!oneFile) {
        var list_of_files = new Array(				
				"belgis_map.min.js",				
				"belgis_tiles.min.js",
				"belgis_layer.min.js",
				"belgis_math.min.js",
				"belgis_poi.min.js",
				"belgis_common.min.js",
				"belgis_search_np.min.js",
				"belgis_graphics.min.js"
        );

        var usr_agent = navigator.userAgent;
        var ie_or_safari = (usr_agent.match("MSIE") || (usr_agent.match("Safari") && !usr_agent.match("Chrome")));
        if(ie_or_safari) {
            var allScripts = new Array(list_of_files.length);
        }
        var this_loc = BelgisMapApi.getLocation();    
        
		for (var i=0, files_count=list_of_files.length; i<files_count; i++) {
            if (ie_or_safari) {
                allScripts[i] = "<script  src='" + this_loc + list_of_files[i] +
                                   "'></script>"; 
            } else {
                var _script = document.createElement("script");
                _script.src = this_loc + list_of_files[i];
				var name = list_of_files[i];
				var _parent = document.getElementsByTagName("head")[0];
                _parent.appendChild(_script);
				//console.log("append script: ", _script, " to ", _body);
            }
        }
		
        if (ie_or_safari) {
            document.write(allScripts.join(""));
        }
    }
})();
