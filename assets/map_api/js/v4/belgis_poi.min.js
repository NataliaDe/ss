function PoiLayer(d){var c=new Array();var b="";var a=this;POI=function(g,h,k){this.id=g.id;this.B=g.lon;this.L=g.lat;this.descr=g.descr;this.icon=g.icon;this.text=g.text;this.mapHeight=h.height;this.clickFunc=g.clickFunc;this.clickable=typeof(g.clickable)=="undefined"?typeof(this.clickFunc)!="undefined":g.clickable;this.hoverable=typeof(g.hoverable)=="undefined"?true:g.hoverable;this.callback=k;this.removed=false;this.shortDescr="";this.bubble=g.bubbleType;if(g.shDescr!=""){this.shortDescr=g.shDescr}else{var j=this.descr.indexOf("<h1>");if(j!=-1){j+=4;var f=this.descr.indexOf("</h1>");this.shortDescr=this.descr.slice(j,f)}}this.placeX=0;this.placeY=0;this.recalc=function(p){var n=this.placeX;var m=this.placeY;this.placeX=p.dLeft-parseFloat(-(this.B)/p.PixelMeterX+p.width/2-p.metersXS/2)+p.width/2;this.placeY=p.dTop-parseFloat((this.L)/p.PixelMeterY+p.height/2-p.metersYS/2)+p.height/2;n-=this.placeX;m-=this.placeY;var l=document.getElementById("belgis_p"+this.id);if(l!=null&&typeof(l)!="undefined"){var o=l.lastChild;n=l.style.left.replace("px","");m=l.style.top.replace("px","");l.style.top=parseInt(this.placeY-o.imgY)+"px";l.style.left=parseInt(this.placeX-o.imgX)+"px";n-=l.style.left.replace("px","");m-=l.style.top.replace("px","")}return{dx:n,dy:m}};this.recalc(h);var e=this;this.drawPOI=function(m){var n=document.createElement("img");if(this.text!==""){var l=document.createElement("div");l.innerHTML=this.text;l.className="belgis_text_for_poi"}n.onload=function(){if(e.removed==false){if(typeof(this.height)==="undefined"){this.imgY=this.clientHeight/2;this.imgX=this.clientWidth/2}else{this.imgY=this.height/2;this.imgX=this.width/2}n.setAttribute("imgY",this.imgY);n.setAttribute("imgX",this.imgX);var o=document.createElement("div");o.className="belgis_for_poi";o.id="belgis_p"+e.id;o.style.top=parseInt(e.placeY-this.imgY)+"px";o.style.position="absolute";o.style.left=parseInt(e.placeX-this.imgX)+"px";o.style.zIndex="99";if(e.text!==""){o.appendChild(l)}o.appendChild(n);document.getElementById(m).appendChild(o);if(typeof(e.callback)=="function"){e.callback()}if(e.clickable){attachClick(o,e.id,e.descr,e.clickFunc,e.B,e.L)}if(e.hoverable){attachOver(o,e.id,e.descr);attachOut(o,e.id)}}};n.src=this.icon};attachClick=function(n,m,q,o,t,r){n.style.cursor="pointer";if(n.attachEvent){var s=q;var v=m;var l=t;var p=r;var u=function(w){o(v,s,l,p);w.stopPropagation()};n.attachEvent("onclick",u)}else{var u=function(A){var z=q;var y=m;var x=t;var w=r;o(y,z,x,w);A.stopPropagation()};n.addEventListener("click",u)}};attachOver=function(n,q,o){if(n.attachEvent){var p=o;var l=q;var m=function(r){POI.onShowDescription(l,p);r.stopPropagation()};n.attachEvent("onmouseover",m)}else{var m=function(t){var s=o;var r=q;POI.onShowDescription(r,s);t.stopPropagation()};n.addEventListener("mouseover",m)}};attachOut=function(n,o){if(n.attachEvent){var l=o;var m=function(p){POI.onCloseBubble(l);p.stopPropagation()};n.attachEvent("onmouseout",m)}else{var m=function(q){var p=o;POI.onCloseBubble(p);q.stopPropagation()};n.addEventListener("mouseout",m)}}};POI.onCloseBubble=function(f){var e=document.getElementById("belgis_buble"+f);if(typeof(e)!="undefined"&&e!=null){document.getElementById(d).removeChild(e)}};POI.onShowDescription=function(m,h){if(typeof(m)==="undefined"){return}if(typeof(bubbleType)=="undefined"||bubbleType==null){bubbleType=0}var f=document.getElementById("belgis_p"+m);if(typeof(f)=="undefined"){return}var l=parseInt(f.style.left.replace("px",""));var k=parseInt(f.style.top.replace("px",""));var e=h.replace(/<\/?(script|embed|applet|object)[^>]*?(>|$)/gi,"");var n={w:350,h:100};n=BelgeoCommon.getDimensions(e,n);if(this.mapHeight/(n.h+90)<2){n.w=n.w*this.mapHeight/(n.h+90);n.h=0;n=BelgeoCommon.getDimensions(e,n)}var g=document.createElement("div");g.id="belgis_buble"+m;g.className="belgis_bubble";l+=f.lastChild.imgX;k+=f.lastChild.imgY;g.style.width=n.w+"px";g.style.top=parseInt(k+10)+"px";g.style.zIndex="200";g.style.left=parseInt(l+10)+"px";var j=document.createElement("div");j.className="belgis_bubble_text";j.innerHTML=e;g.appendChild(j);document.getElementById(d).appendChild(g)};this.recaclPoiPlace=function(f,j){var h=false;var g=0;var e=c.length;while(!h&&g<e){if(c[g].id==f){c[g].recalc(j);h=true}g++}};this.removePoi=function(g){var j=false;var h=0;var e=c.length;while(!j&&h<e){if(c[h].id==g){c.splice(h,1);j=true}h++}var f=document.getElementById("belgis_p"+g);if(typeof(f)!="undefined"&&f!=null){document.getElementById(d).removeChild(f)}};this.removeAllPoi=function(f){var e=c.length;clearPOI=function(h){var g=document.getElementById(h).innerHTML="";for(i=0;i<e;i++){if(typeof(c[i])!="undefined"){c[i].removed=true}}c.splice(0,e)};setTimeout(function(){clearPOI(f)},0)};this.recalcAllPOI=function(h,g){var e=c.length;var j=null;for(var f=0;f<e;f++){j=c[f].recalc(h)}};this.addPoi=function(e,k,h,l){var f=c.length;var j=true;var g=0;for(g=0;g<f;g++){if(c[g].id==e.id){j=false;break}}if(j){c[f]=new POI(e,k,l);c[f].drawPOI(h)}else{this.recaclPoiPlace(g,k)}}};